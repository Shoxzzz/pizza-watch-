<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>äº”è§’å¤§æ¥¼æƒ…æŠ¥å±€</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700;900&family=JetBrains+Mono:wght@500&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <style>
        :root { 
            --bg: #050505; --card-bg: #111; --text: #e0e0e0; --sub: #666;
            --danger: #ff453a; --warn: #ffd60a; --safe: #32d74b; --blue: #0a84ff;
            --card-border: 1px solid #222;
        }
        body { background: var(--bg); color: var(--text); font-family: 'Noto Sans SC', sans-serif; margin: 0; padding: 0; padding-bottom: 100px; line-height: 1.5; }
        
        .header { padding: 18px 24px; background: rgba(5,5,5,0.9); position: sticky; top: 0; z-index: 99; border-bottom: var(--card-border); display: flex; justify-content: space-between; align-items: center; backdrop-filter: blur(20px); }
        .title { font-weight: 900; letter-spacing: 1.5px; font-size: 16px; color: #fff; text-transform: uppercase; }
        .live-badge { font-size: 11px; font-weight: 700; color: var(--safe); background: rgba(50,215,75,0.1); padding: 4px 8px; border-radius: 4px; display: flex; align-items: center; gap: 6px; border: 1px solid rgba(50,215,75,0.2); }
        .blink { width: 6px; height: 6px; background: currentColor; border-radius: 50%; animation: blink 1.5s infinite; } @keyframes blink { 0% {opacity:1} 50% {opacity:0.3} }

        .container { padding: 20px; display: flex; flex-direction: column; gap: 20px; max-width: 600px; margin: 0 auto; }

        /* çŠ¶æ€æ  */
        .status-banner { background: #0a0a0a; border: var(--card-border); border-radius: 12px; padding: 20px; position: relative; overflow: hidden; }
        .status-label { font-size: 11px; font-weight: 700; letter-spacing: 1px; text-transform: uppercase; color: var(--sub); }
        .status-main { font-size: 28px; font-weight: 900; margin: 6px 0; letter-spacing: -0.5px; }
        .status-desc { font-size: 12px; color: var(--sub); }
        .status-bg-glow { position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0.05; pointer-events: none; }
        
        /* ä»ªè¡¨ç›˜ */
        .dashboard-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .dash-card { background: var(--card-bg); border: var(--card-border); border-radius: 12px; padding: 16px; display: flex; flex-direction: column; justify-content: center; }
        .dash-val { font-size: 26px; font-weight: 900; margin-top: 2px; }
        .dash-lbl { font-size: 11px; color: var(--sub); font-weight: 700; text-transform: uppercase; }

        /* å¡ç‰‡ */
        .card { background: var(--card-bg); border: var(--card-border); border-radius: 12px; padding: 16px; display: flex; flex-direction: column; gap: 12px; position: relative; }
        .card.core { border-color: rgba(255, 69, 58, 0.4); box-shadow: 0 0 20px rgba(255, 69, 58, 0.05) inset; }
        
        .tac-tag { position: absolute; top: 0; right: 0; font-size: 9px; font-weight: 900; padding: 3px 10px; border-bottom-left-radius: 10px; letter-spacing: 0.5px; }
        .tag-red { background: rgba(255,69,58,0.15); color: var(--danger); border-left: 1px solid var(--danger); border-bottom: 1px solid var(--danger); }
        .tag-blue { background: rgba(10,132,255,0.15); color: var(--blue); border-left: 1px solid var(--blue); border-bottom: 1px solid var(--blue); }
        .tag-yellow { background: rgba(255,214,10,0.15); color: var(--warn); border-left: 1px solid var(--warn); border-bottom: 1px solid var(--warn); }
        .tag-green { background: rgba(50,215,75,0.15); color: var(--safe); border-left: 1px solid var(--safe); border-bottom: 1px solid var(--safe); }

        .row-top { display: flex; justify-content: space-between; align-items: flex-start; padding-right: 50px; }
        .shop-name { font-size: 16px; font-weight: 800; color: #eee; margin-bottom: 2px; }
        .shop-desc { font-size: 11px; color: var(--sub); }
        .big-score { font-size: 32px; font-weight: 900; line-height: 1; }
        
        .row-stats { display: flex; gap: 12px; background: #050505; padding: 10px 12px; border-radius: 8px; border: var(--card-border); }
        .stat-box { flex: 1; display: flex; flex-direction: column; } 
        .stat-val { font-size: 13px; font-weight: 700; font-family: 'JetBrains Mono'; } 
        .stat-lbl { font-size: 10px; color: #555; font-weight: 600; text-transform: uppercase; }
        
        .spark-container { display: flex; align-items: flex-end; gap: 2px; height: 12px; margin-top: 6px; padding-top: 8px; border-top: 1px dashed #222; opacity: 0.6; }
        .spark-bar { flex: 1; background: #333; border-radius: 1px; min-height: 2px; }

        /* ğŸ”¥ V37 å†›æƒ…ç”µè®¯ (Military Intel) */
        .news-head { font-size: 12px; font-weight: 900; color: #888; padding-bottom: 8px; margin-bottom: 12px; display: flex; align-items: center; gap: 8px; letter-spacing: 1px; text-transform: uppercase; border-bottom: 1px solid #222; }
        .news-icon { color: var(--danger); }
        
        .news-item { 
            background: #0a0a0a; border: 1px solid #222; border-left: 2px solid var(--sub); 
            padding: 14px; border-radius: 0 8px 8px 0; margin-bottom: 8px; 
            display: flex; flex-direction: column; gap: 6px;
            text-decoration: none; transition: all 0.2s; 
        }
        .news-item:active { background: #151515; border-left-color: #fff; }
        
        .news-meta { font-family: 'JetBrains Mono', monospace; font-size: 10px; color: var(--sub); display: flex; justify-content: space-between; }
        .news-source { color: var(--blue); font-weight: 700; }
        .news-title { color: #ddd; font-size: 13px; font-weight: 600; line-height: 1.4; }

        /* æ‰‹å†Œ */
        .manual { background: #0a0a0a; border: var(--card-border); border-radius: 12px; padding: 20px; display: flex; flex-direction: column; gap: 24px; }
        .man-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .matrix-card { background: #111; border: var(--card-border); border-radius: 8px; padding: 12px; display: flex; flex-direction: column; gap: 6px; }
        
        .formula-row { display: flex; align-items: center; gap: 4px; font-family: 'JetBrains Mono', monospace; font-size: 10px; font-weight: bold; flex-wrap: wrap; }
        .f-tag { padding: 2px 6px; border-radius: 4px; border: 1px solid; }
        .f-red { border-color: rgba(255,69,58,0.4); color: var(--danger); }
        .f-gray { border-color: #333; color: #666; }
        .f-green { border-color: rgba(50,215,75,0.4); color: var(--safe); }
        
        .res-title { font-weight: 900; font-size: 12px; margin-top: 4px; }
        .res-desc { font-size: 10px; color: var(--sub); }
        
        .loading, .empty-state { text-align: center; padding: 20px; color: var(--sub); font-size: 12px; background: #0a0a0a; border-radius: 8px; border: 1px dashed #333; }
    </style>
</head>
<body>
    <div class="header">
        <div class="title">äº”è§’å¤§æ¥¼æƒ…æŠ¥å±€</div>
        <div class="live-badge"><div class="blink"></div>LIVE</div>
    </div>

    <div class="container">
        <div id="status-area"><div class="loading">æ­£åœ¨è¯„ä¼°æ€åŠ¿...</div></div>
        
        <div id="dash-area"></div>
        
        <div>
            <div class="news-head"><span class="news-icon">âš¡</span> å†›æƒ…ç”µè®¯ (MILITARY INTEL)</div>
            <div id="news-feed"><div class="loading">æ­£åœ¨æˆªè·åŠ å¯†é€šè®¯...</div></div>
        </div>

        <div>
            <div class="news-head"><span>ğŸ•</span> åœ°é¢çƒ­åº¦ç›‘æ§</div>
            <div id="list-area"><div class="loading">è¿æ¥åœ°é¢æ¢é’ˆ...</div></div>
        </div>

        <div class="manual">
            <div class="news-head"><span>ğŸ§ </span> æˆ˜æœ¯åˆ¤è¯»çŸ©é˜µ</div>
            <div class="matrix-grid">
                <div class="matrix-card" style="border-left: 3px solid var(--danger)">
                    <div class="formula-row"><span class="f-tag f-red">SUPPLY é«˜</span>+<span class="f-tag f-gray">CORE ä½</span></div>
                    <div><div class="res-title" style="color:var(--danger)">ğŸš¨ å†…éƒ¨å°é”</div><div class="res-desc">åªè¿›ä¸å‡ºï¼Œä¾èµ–å¤–å–</div></div>
                </div>
                <div class="matrix-card" style="border-left: 3px solid var(--danger)">
                    <div class="formula-row"><span class="f-tag f-red">CORE é«˜</span>+<span class="f-tag f-gray">FLANK ä½</span></div>
                    <div><div class="res-title" style="color:var(--danger)">ğŸ¯ ç¡®è®¤è¡ŒåŠ¨</div><div class="res-desc">ä»…äº”è§’å¤§æ¥¼æ´»è·ƒ</div></div>
                </div>
                <div class="matrix-card" style="border-left: 3px solid var(--warn)">
                    <div class="formula-row"><span class="f-tag f-red">CORE é«˜</span>+<span class="f-tag f-red" style="color:var(--warn);border-color:var(--warn)">CROWD é«˜</span></div>
                    <div><div class="res-title" style="color:var(--warn)">ğŸ“¢ å…¬å…±äº‹ä»¶</div><div class="res-desc">åª’ä½“/æ¸¸å®¢èšé›†</div></div>
                </div>
                <div class="matrix-card" style="border-left: 3px solid #fff">
                    <div class="formula-row"><span class="f-tag f-red">CORE é«˜</span>+<span class="f-tag f-green">FLANK é«˜</span></div>
                    <div><div class="res-title" style="color:#fff">ğŸ‰ è™šå‡è­¦æŠ¥</div><div class="res-desc">å…¨åŒºå‘¨æœ«èšé¤</div></div>
                </div>
            </div>
        </div>
        
        <div style="text-align:center; font-size:10px; color:#333; margin-top:10px;">OPS V37 // TACTICAL FEED</div>
    </div>

    <script>
        const DICT = {
            "District": { name: "ç‰¹åŒºæŠ«è¨", desc: "æ ¸å¿ƒå“¨æ‰€", tag: "CORE", cls: "tag-red", core: true },
            "Domino":   { name: "è¾¾ç¾ä¹",   desc: "åå‹¤è¡¥ç»™", tag: "SUPPLY", cls: "tag-blue", core: false },
            "Papa":     { name: "æ£’çº¦ç¿°",   desc: "åå‹¤è¡¥ç»™", tag: "SUPPLY", cls: "tag-blue", core: false },
            "Wiseguy":  { name: "Wiseguy",  desc: "äººå‘˜èšé›†", tag: "CROWD", cls: "tag-yellow", core: false },
            "We":       { name: "WeæŠ«è¨",   desc: "ä¾§ç¿¼è§‚å¯Ÿ", tag: "FLANK", cls: "tag-green", core: false }
        };

        Papa.parse("pizza_data.csv", { download: true, header: true, skipEmptyLines: true, complete: res => renderPizza(res.data), error: () => document.getElementById('list-area').innerHTML='<div class="empty-state">âŒ æ¢é’ˆç¦»çº¿</div>' });
        Papa.parse("pentagon_news.csv", { download: true, header: true, skipEmptyLines: true, complete: res => renderNews(res.data), error: () => document.getElementById('news-feed').innerHTML='<div class="empty-state">ğŸ“¡ æ— ä¿¡å·</div>' });

        function renderNews(data) {
            const el = document.getElementById('news-feed');
            if(!data || !data.length) { el.innerHTML = '<div class="empty-state">ğŸ“¡ æš‚æ— æˆ˜æœ¯æƒ…æŠ¥</div>'; return; }
            el.innerHTML = "";
            data.slice(0, 5).forEach(r => {
                const time = r.Time || "--:--"; const src = r.Source || "UNK"; const title = r.Title || "No Data"; const link = r.Link || "#";
                el.innerHTML += `<a href="${link}" target="_blank" class="news-item"><div class="news-meta"><span>${time}</span><span class="news-source"> // ${src}</span></div><div class="news-title">${title}</div></a>`;
            });
        }

        function renderPizza(data) {
            if(!data || !data.length) return;
            const groups = {};
            data.forEach(r => {
                let k = null; const n = r.Name||"";
                if(n.includes("District")) k="District"; else if(n.includes("Domino")) k="Domino";
                else if(n.includes("Papa")) k="Papa"; else if(n.includes("Wiseguy")) k="Wiseguy";
                else if(n.includes("We")) k="We";
                if(k) { if(!groups[k]) groups[k]=[]; groups[k].push({p: parseInt(r['Live Popularity']||0), t: r['Timestamp (ET)']||"00:00"}); }
            });

            let total=0, diffTotal=0, corePop=0; const list = [];
            Object.keys(groups).forEach(k => {
                const hist = groups[k]; const curr = hist[hist.length-1];
                if(k==="District") corePop = curr.p;
                let d = 0; if(hist.length>=2) d = curr.p - hist[hist.length-2].p;
                total += curr.p; diffTotal += d;
                list.push({key:k, hist:hist, curr:curr, diff:d});
            });

            list.sort((a,b) => {
                const cA = DICT[a.key].core; const cB = DICT[b.key].core;
                if(cA===cB) return b.curr.p - a.curr.p;
                return cA ? -1 : 1;
            });

            let sTxt="å¹³é™ (NORMAL)", sDesc="åŒºåŸŸæ´»åŠ¨æ­£å¸¸ï¼Œæ— æˆ˜æœ¯å¼‚å¸¸ã€‚", sCol="var(--safe)", sGlow="rgba(50,215,75,0.1)";
            if(total > 150 || corePop > 80) { sTxt="ç´§æ€¥ (CRITICAL)"; sDesc="ğŸš¨ æ£€æµ‹åˆ°ä¸¥é‡æ´»åŠ¨å³°å€¼ï¼Œè¯·æ ¸å¯¹å†›æƒ…ç”µè®¯ã€‚"; sCol="var(--danger)"; sGlow="rgba(255,69,58,0.2)"; }
            else if(total > 100 || corePop > 50) { sTxt="æ´»è·ƒ (ELEVATED)"; sDesc="âš ï¸ æ´»åŠ¨æ°´å¹³é«˜äºå¹³æ—¶ã€‚"; sCol="var(--warn)"; sGlow="rgba(255,214,10,0.15)"; }
            
            document.getElementById('status-area').innerHTML = `<div class="status-banner" style="border-color:${sCol}"><div class="status-bg-glow" style="background:${sCol}; opacity:0.05"></div><div class="status-label" style="color:${sCol}">å½“å‰å¨èƒç­‰çº§</div><div class="status-main" style="color:${sCol}">${sTxt}</div><div class="status-desc">${sDesc}</div></div>`;

            let dCol = diffTotal>0 ? "var(--danger)" : (diffTotal<0?"var(--safe)":"var(--sub)");
            let dSym = diffTotal>0 ? "+" : "";
            document.getElementById('dash-area').innerHTML = `<div class="dashboard-grid"><div class="dash-card"><div class="dash-lbl">å®æ—¶æ€»çƒ­åº¦</div><div class="dash-val" style="color:${total>150?'var(--danger)':'#fff'}">${total}</div></div><div class="dash-card"><div class="dash-lbl">1H å˜åŒ–é‡</div><div class="dash-val" style="color:${dCol}">${dSym}${diffTotal}</div></div></div>`;

            const el = document.getElementById('list-area'); el.innerHTML="";
            list.forEach(i => {
                const conf = DICT[i.key];
                const dfCol = i.diff>0 ? "var(--danger)" : (i.diff<0 ? "var(--safe)" : "var(--sub)");
                const dfSym = i.diff>0 ? "â–²" : (i.diff<0 ? "â–¼" : "");
                const timeStr = i.curr.t.includes(" ") ? i.curr.t.split(" ")[1].substring(0,5) : i.curr.t;
                
                let bars = ""; const spark = i.hist.slice(-20);
                spark.forEach((d,idx) => {
                    const isLast = idx===spark.length-1;
                    const h = Math.max(5, d.p);
                    const bg = isLast ? '#fff' : (d.p>50 ? '#ff453a' : '#333');
                    bars += `<div class="spark-bar" style="height:${h}%; background:${bg}; opacity:${isLast?1:0.7}"></div>`;
                });

                el.innerHTML += `<div class="card ${conf.core?'core':''}">
                    <div class="tac-tag ${conf.cls}">${conf.tag}</div>
                    <div class="row-top"><div><div class="shop-name">${conf.name}</div><div class="shop-desc">${conf.desc}</div></div><div class="big-score" style="color:${i.curr.p>50?'var(--danger)':'#fff'}">${i.curr.p}</div></div>
                    <div class="row-stats"><div class="stat-box"><div class="stat-lbl">1H å˜åŒ–</div><div class="stat-val" style="color:${dfCol}">${dfSym} ${i.diff}</div></div><div class="stat-box" style="padding-left:12px; border-left:1px solid #222"><div class="stat-lbl">æ›´æ–°äº</div><div class="stat-val" style="color:var(--sub)">${timeStr}</div></div></div>
                    <div class="spark-container">${bars}</div>
                </div>`;
            });
        }
    </script>
</body>
</html>
