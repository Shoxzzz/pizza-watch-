<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>äº”è§’å¤§æ¥¼æƒ…æŠ¥ V16</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@500;700;900&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <style>
        :root { --bg: #000; --card: #151515; --text: #fff; --sub: #888; --danger: #ff453a; --warn: #ff9f0a; --success: #30d158; --blue: #0a84ff; }
        body { background: var(--bg); color: var(--text); font-family: 'Inter', sans-serif; margin: 0; padding: 0; min-height: 100vh; display: flex; flex-direction: column; padding-top: env(safe-area-inset-top); padding-bottom: env(safe-area-inset-bottom); }
        
        /* é¡¶éƒ¨ */
        .header { padding: 15px 20px; background: rgba(20,20,20,0.9); border-bottom: 1px solid #333; position: sticky; top: 0; z-index: 100; backdrop-filter: blur(10px); display: flex; justify-content: space-between; align-items: center; }
        .brand { font-weight: 900; font-size: 18px; letter-spacing: -0.5px; text-transform: uppercase; }
        .status { font-size: 12px; font-weight: bold; color: var(--success); display: flex; align-items: center; gap: 6px; background: rgba(48, 209, 88, 0.15); padding: 4px 10px; border-radius: 20px; }
        .dot { width: 8px; height: 8px; background: currentColor; border-radius: 50%; animation: pulse 1.5s infinite; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.3; } 100% { opacity: 1; } }

        /* åˆ—è¡¨å®¹å™¨ */
        .list-container { padding: 20px; display: flex; flex-direction: column; gap: 15px; padding-bottom: 40px; }
        
        /* æˆ˜æœ¯å¡ç‰‡ */
        .tac-card { 
            background: var(--card); 
            border: 1px solid #333; 
            border-radius: 16px; 
            padding: 16px; 
            position: relative; 
            overflow: hidden; 
            transition: all 0.2s;
        }
        
        /* å¤´éƒ¨ï¼šåº—å + çƒ­åº¦å€¼ */
        .card-top { display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 10px; position: relative; z-index: 2; }
        .shop-info { display: flex; flex-direction: column; gap: 2px; }
        .shop-name { font-size: 16px; font-weight: 700; color: #fff; }
        .shop-tag { font-size: 11px; color: var(--sub); font-weight: 500; }
        
        .hot-val { font-size: 28px; font-weight: 900; line-height: 1; color: #fff; text-align: right; }
        .hot-lbl { font-size: 10px; color: var(--sub); text-align: right; margin-top: 4px; }

        /* è¿›åº¦æ¡ (è¡€æ¡) èƒŒæ™¯ */
        .bar-bg { height: 8px; background: #222; border-radius: 4px; width: 100%; position: relative; overflow: hidden; }
        /* è¿›åº¦æ¡ å¡«å…… */
        .bar-fill { height: 100%; border-radius: 4px; width: 0%; transition: width 1s cubic-bezier(0.4, 0, 0.2, 1); }
        
        /* çŠ¶æ€æ ‡ç­¾ */
        .status-badge { 
            position: absolute; top: 16px; right: 16px; 
            font-size: 10px; font-weight: 700; padding: 2px 6px; border-radius: 4px; display: none;
        }

        /* åº•éƒ¨ä¿¡æ¯ */
        .card-footer { margin-top: 12px; display: flex; justify-content: space-between; font-size: 11px; color: #666; }
        .trend { font-weight: bold; }

        /* âš ï¸ é¢œè‰²å®šä¹‰ */
        .c-red { background: var(--danger); box-shadow: 0 0 10px rgba(255, 69, 58, 0.4); }
        .c-blue { background: var(--blue); }
        .c-purple { background: #bf5af2; }
        .c-yellow { background: var(--warn); }
        .c-green { background: var(--success); }

        /* ç©ºçŠ¶æ€ */
        .loading { text-align: center; color: #555; margin-top: 50px; font-size: 12px; }
    </style>
</head>
<body>

    <div class="header">
        <div class="brand">PENTAGON OPS</div>
        <div class="status"><div class="dot"></div>LIVE</div>
    </div>

    <div class="list-container" id="main-list">
        <div class="loading">æ­£åœ¨è¿æ¥å«æ˜Ÿæ•°æ®...</div>
    </div>

    <script>
        // ğŸ› ï¸ æš´åŠ›æ±‰åŒ–é…ç½®
        const CONFIG = {
            "District": { name: "ç‰¹åŒºæŠ«è¨", tag: "æ ¸å¿ƒæ®ç‚¹", color: "c-red" },
            "Domino":   { name: "è¾¾ç¾ä¹",   tag: "å¤–å–é…é€", color: "c-blue" },
            "Papa":     { name: "æ£’çº¦ç¿°",   tag: "å¤–å–é…é€", color: "c-purple" },
            "Wiseguy":  { name: "Wiseguy",  tag: "åˆ‡ç‰‡åº—",   color: "c-yellow" },
            "We":       { name: "WeæŠ«è¨",   tag: "æ°´æ™¶åŸ",   color: "c-green" }
        };

        Papa.parse("pizza_data.csv", {
            download: true, header: true, skipEmptyLines: true,
            complete: function(results) {
                renderList(results.data);
            },
            error: function() {
                document.getElementById('main-list').innerHTML = '<div class="loading">æ•°æ®è¯»å–å¤±è´¥ï¼Œè¯·æ£€æŸ¥CSV</div>';
            }
        });

        function renderList(data) {
            if(!data || data.length === 0) return;

            // 1. è·å–æœ€æ–°ä¸€æ¬¡çš„æ›´æ–°æ—¶é—´
            const lastRow = data[data.length - 1];
            const latestTime = lastRow['Timestamp (ET)'];

            // 2. æå–æœ€æ–°ä¸€æ‰¹æ•°æ® (å‡è®¾ä¸€æ¬¡æŠ“5ä¸ªï¼Œå°±å€’ç€æ‰¾è¿™5ä¸ª)
            // ä¸ºäº†ä¿é™©ï¼Œæˆ‘ä»¬éå†æœ€å20è¡Œï¼ŒæŠŠæ¯ä¸ªåº—çš„æœ€æ–°æ•°æ®æ‰¾å‡ºæ¥
            const latestStatus = {}; 
            
            // å€’åºéå†ï¼Œæ‰¾åˆ°æ¯å®¶åº—æœ€æ–°çš„è®°å½•
            for (let i = data.length - 1; i >= 0; i--) {
                let row = data[i];
                let rawName = row.Name;
                if (!rawName) continue;

                // åŒ¹é… Key
                let key = null;
                if(rawName.includes("District")) key = "District";
                else if(rawName.includes("Domino")) key = "Domino";
                else if(rawName.includes("Papa")) key = "Papa";
                else if(rawName.includes("We")) key = "We";
                else if(rawName.includes("Wiseguy")) key = "Wiseguy";

                if (key && !latestStatus[key]) {
                    latestStatus[key] = {
                        pop: parseInt(row['Live Popularity'] || 0),
                        gap: parseInt(row['Gap'] || 0), // å¼‚å¸¸åå·®
                        time: row['Timestamp (ET)'].split(" ")[1].substring(0, 5) // å– HH:mm
                    };
                }
                // å¦‚æœ5å®¶éƒ½æ‰¾åˆ°äº†ï¼Œå°±åœæ­¢
                if (Object.keys(latestStatus).length === 5) break;
            }

            // 3. è½¬æˆæ•°ç»„å¹¶æ’åº (æŒ‰çƒ­åº¦ä»é«˜åˆ°ä½ï¼)
            // è¿™æ ·æœ€å¿™çš„åº—æ°¸è¿œåœ¨æœ€ä¸Šé¢ï¼Œä¸ç”¨ä½ å»ç¿»æŠ˜çº¿å›¾
            const sortedShops = Object.keys(latestStatus).map(key => {
                return { key: key, ...latestStatus[key] };
            }).sort((a, b) => b.pop - a.pop);

            // 4. ç”Ÿæˆ HTML
            const container = document.getElementById('main-list');
            container.innerHTML = ""; // æ¸…ç©º Loading

            // æ˜¾ç¤ºæ•°æ®æ—¶é—´
            container.innerHTML += `<div style="font-size:10px; color:#444; margin-bottom:10px; text-align:right;">æ•°æ®æ›´æ–°äº: ${latestTime}</div>`;

            sortedShops.forEach(shop => {
                const info = CONFIG[shop.key];
                const percent = shop.pop; // 0-100
                
                // å¼‚å¸¸æ£€æµ‹æ–‡æ¡ˆ
                let trendHtml = `<span style="color:#666">å¹³ç¨³</span>`;
                if(shop.gap > 15) trendHtml = `<span style="color:var(--danger)">ğŸ”¥ æ¿€å¢ (+${shop.gap})</span>`;
                else if(shop.gap > 0) trendHtml = `<span style="color:var(--warn)">ğŸ“ˆ ä¸Šå‡ (+${shop.gap})</span>`;
                else if(shop.gap < 0) trendHtml = `<span style="color:var(--success)">ğŸ“‰ ä¸‹é™ (${shop.gap})</span>`;

                const card = `
                <div class="tac-card">
                    <div class="card-top">
                        <div class="shop-info">
                            <div class="shop-name">${info.name}</div>
                            <div class="shop-tag">${info.tag}</div>
                        </div>
                        <div>
                            <div class="hot-val" style="color: ${percent > 50 ? 'var(--danger)' : '#fff'}">${percent}</div>
                            <div class="hot-lbl">å®æ—¶å¼ºåº¦</div>
                        </div>
                    </div>
                    
                    <div class="bar-bg">
                        <div class="bar-fill ${info.color}" style="width: ${percent}%"></div>
                    </div>

                    <div class="card-footer">
                        <div>æ›´æ–°æ—¶é—´: ${shop.time}</div>
                        <div class="trend">${trendHtml}</div>
                    </div>
                </div>
                `;
                container.innerHTML += card;
            });
        }
    </script>
</body>
</html>
