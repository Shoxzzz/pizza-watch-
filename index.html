<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>äº”è§’å¤§æ¥¼æƒ…æŠ¥å±€</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;700;900&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <style>
        :root { 
            --bg: #000000; 
            --card-bg: #121212; 
            --dash-bg: #1a1a1a;
            --text: #ffffff; 
            --sub-text: #666;
            --danger: #ff3b30;
            --warn: #ffcc00;
            --safe: #32d74b;
            --blue: #0a84ff;
        }

        html, body {
            background-color: var(--bg);
            color: var(--text);
            font-family: 'Noto Sans SC', sans-serif;
            margin: 0; padding: 0;
            width: 100%;
            overflow-y: auto; 
            -webkit-overflow-scrolling: touch;
        }

        .header {
            padding: 16px 20px;
            background: rgba(10, 10, 10, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid #222;
            position: sticky; top: 0; z-index: 999;
            display: flex; justify-content: space-between; align-items: center;
        }
        .title { font-size: 16px; font-weight: 900; letter-spacing: 1px; color: #fff; }
        .live-badge {
            font-size: 11px; font-weight: bold; color: var(--safe);
            background: rgba(50, 215, 75, 0.1);
            padding: 4px 8px; border-radius: 4px;
            display: flex; align-items: center; gap: 6px;
        }
        .blink { width: 6px; height: 6px; background: currentColor; border-radius: 50%; animation: blink 2s infinite; }
        @keyframes blink { 0% {opacity:1} 50% {opacity:0.3} 100% {opacity:1} }

        .container { padding: 15px; display: flex; flex-direction: column; gap: 15px; padding-bottom: 80px; }

        /* ä»ªè¡¨ç›˜ */
        .dashboard-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 5px; }
        .dash-card {
            background: var(--dash-bg); border: 1px solid #333; border-radius: 12px;
            padding: 15px; display: flex; flex-direction: column; justify-content: center;
            position: relative; overflow: hidden;
        }
        .dash-glow {
            position: absolute; top: -50%; right: -50%; width: 100%; height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.05) 0%, transparent 60%); pointer-events: none;
        }
        .dash-lbl { font-size: 11px; color: #888; text-transform: uppercase; font-weight: bold; margin-bottom: 4px; }
        .dash-val { font-size: 26px; font-weight: 900; line-height: 1; }
        .dash-sub { font-size: 11px; margin-top: 4px; font-weight: 500; }

        /* å¡ç‰‡ */
        .card { 
            background: var(--card-bg); border: 1px solid #2a2a2a; border-radius: 12px; 
            padding: 16px; display: flex; flex-direction: column; gap: 12px; position: relative; overflow: hidden;
        }
        .tac-tag {
            position: absolute; top: 0; right: 0;
            font-size: 9px; font-weight: 900; letter-spacing: 0.5px;
            padding: 3px 10px;
            border-bottom-left-radius: 10px;
            text-transform: uppercase;
        }
        .tag-red { background: rgba(255, 59, 48, 0.2); color: var(--danger); border-left: 1px solid var(--danger); border-bottom: 1px solid var(--danger); }
        .tag-blue { background: rgba(10, 132, 255, 0.2); color: var(--blue); border-left: 1px solid var(--blue); border-bottom: 1px solid var(--blue); }
        .tag-yellow { background: rgba(255, 204, 0, 0.2); color: var(--warn); border-left: 1px solid var(--warn); border-bottom: 1px solid var(--warn); }
        .tag-green { background: rgba(50, 215, 75, 0.2); color: var(--safe); border-left: 1px solid var(--safe); border-bottom: 1px solid var(--safe); }

        .card.core-target {
            border: 1px solid rgba(255, 59, 48, 0.4);
            box-shadow: 0 0 20px rgba(255, 59, 48, 0.05) inset;
        }

        .row-top { display: flex; justify-content: space-between; align-items: flex-start; margin-top: 4px; }
        .shop-name { font-size: 16px; font-weight: 700; color: #fff; margin-bottom: 2px; }
        .shop-desc { font-size: 11px; color: var(--sub-text); }
        .big-score { font-size: 28px; font-weight: 900; line-height: 1; letter-spacing: -1px; }

        .row-stats { display: flex; gap: 10px; padding: 10px; background: #080808; border-radius: 8px; border: 1px solid #222; }
        .stat-box { flex: 1; display: flex; flex-direction: column; gap: 2px; }
        .stat-lbl { font-size: 10px; color: #555; }
        .stat-val { font-size: 13px; font-weight: 700; }

        .spark-container { display: flex; align-items: flex-end; gap: 2px; height: 30px; margin-top: 5px; padding-top: 10px; border-top: 1px dashed #222; }
        .spark-bar { flex: 1; background: #333; border-radius: 2px; min-height: 2px; }

        /* æ‰‹å†Œæ ·å¼ */
        .manual-card { background: #090909; border: 1px solid #333; border-radius: 12px; padding: 20px; display: flex; flex-direction: column; gap: 25px; }
        .man-section-title { 
            font-size: 12px; font-weight: 900; color: #fff; text-transform: uppercase; letter-spacing: 1px; 
            border-bottom: 1px solid #333; padding-bottom: 8px; margin-bottom: 10px;
            display: flex; align-items: center; gap: 6px;
        }
        
        .man-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        
        /* åŸºç¡€å›¾ä¾‹ */
        .demo-box { display: flex; align-items: center; gap: 8px; font-size: 11px; color: #ccc; margin-bottom: 6px; }
        .demo-bar { width: 6px; height: 14px; background: #333; border-radius: 2px; }
        .demo-bar.red { background: var(--danger); box-shadow: 0 0 5px rgba(255, 59, 48, 0.4); }
        .demo-bar.gray { background: #333; }
        .demo-bar.white { background: #fff; }

        /* èµ„äº§æ¡£æ¡ˆ */
        .tag-row { display: flex; align-items: flex-start; gap: 12px; margin-bottom: 12px; }
        .tag-badge { 
            width: 45px; height: 20px; border-radius: 4px; flex-shrink: 0; 
            font-size: 9px; font-weight: 900; display: flex; align-items: center; justify-content: center;
        }
        .bg-red { background: rgba(255,59,48,0.2); color: var(--danger); border: 1px solid var(--danger); }
        .bg-blue { background: rgba(10,132,255,0.2); color: var(--blue); border: 1px solid var(--blue); }
        .bg-yellow { background: rgba(255,204,0,0.2); color: var(--warn); border: 1px solid var(--warn); }
        .bg-green { background: rgba(50,215,75,0.2); color: var(--safe); border: 1px solid var(--safe); }

        .tag-info { display: flex; flex-direction: column; gap: 3px; }
        .tag-title { font-size: 12px; font-weight: bold; color: #eee; }
        .tag-desc { font-size: 11px; color: #888; line-height: 1.4; }

        /* çŸ©é˜µ */
        .matrix-box { display: flex; flex-direction: column; gap: 10px; background: #111; padding: 10px; border-radius: 8px; border: 1px dashed #333; }
        .scenario-row { display: flex; align-items: center; justify-content: space-between; font-size: 11px; color: #ccc; }
        .s-condition { display: flex; align-items: center; gap: 6px; }
        .s-result { font-weight: bold; color: #fff; text-align: right; }
        .s-plus { color: #555; font-size: 9px; }

        .c-red { color: var(--danger); }
        .c-green { color: var(--safe); }
        .c-gray { color: #888; }
        .loading { text-align: center; margin-top: 50px; color: #444; font-size: 12px; }
    </style>
</head>
<body>

    <div class="header">
        <div class="title">äº”è§’å¤§æ¥¼æƒ…æŠ¥å±€</div>
        <div class="live-badge"><div class="blink"></div>LIVE</div>
    </div>

    <div class="container">
        <div id="dash-area"></div>
        <div id="list-area">
            <div class="loading">æ­£åœ¨è§£å¯†å«æ˜Ÿæ•°æ®æµ...</div>
        </div>

        <div class="manual-card">
            
            <div>
                <div class="man-section-title"><span>ğŸ“Š</span> åŸºç¡€å›¾ä¾‹ (BASIC LEGEND)</div>
                <div class="man-grid">
                    <div>
                        <div style="font-size:10px; color:#888; font-weight:bold; margin-bottom:5px;">é¢œè‰²å«ä¹‰</div>
                        <div class="demo-box">
                            <div class="demo-bar red"></div> <span>çƒ­åº¦ > 50 (é«˜å±)</span>
                        </div>
                        <div class="demo-box">
                            <div class="demo-bar gray"></div> <span>çƒ­åº¦ < 50 (å¸¸æ€)</span>
                        </div>
                    </div>
                    <div>
                        <div style="font-size:10px; color:#888; font-weight:bold; margin-bottom:5px;">è¿·ä½ èµ°åŠ¿å›¾</div>
                        <div style="display:flex; align-items:flex-end; gap:3px; height:20px; opacity:0.8; margin-bottom:4px;">
                            <div class="demo-bar gray" style="height:30%"></div>
                            <div class="demo-bar gray" style="height:50%"></div>
                            <div class="demo-bar red" style="height:90%"></div>
                            <div class="demo-bar white" style="height:60%"></div>
                        </div>
                        <div style="font-size:9px; color:#555;">â—€ è¿‡å» &nbsp;&nbsp;&nbsp; ç°åœ¨ (ç™½) â–¶</div>
                    </div>
                </div>
            </div>

            <div>
                <div class="man-section-title"><span>ğŸ“‚</span> èµ„äº§æˆ˜æœ¯æ¡£æ¡ˆ (ASSET PROFILES)</div>
                
                <div class="tag-row">
                    <div class="tag-badge bg-red">CORE</div>
                    <div class="tag-info">
                        <div class="tag-title">ç‰¹åŒºæŠ«è¨ (District Pizza)</div>
                        <div class="tag-desc"><strong>æ ¸å¿ƒå“¨æ‰€</strong>ã€‚è·ç¦»æœ€è¿‘ï¼Œæœ€æ•æ„Ÿçš„å†…éƒ¨é£å‘æ ‡ã€‚</div>
                    </div>
                </div>

                <div class="tag-row">
                    <div class="tag-badge bg-blue">SUPPLY</div>
                    <div class="tag-info">
                        <div class="tag-title">è¾¾ç¾ä¹ / æ£’çº¦ç¿° (Delivery)</div>
                        <div class="tag-desc"><strong>è¡¥ç»™çº¿</strong>ã€‚ä¸»è¥å¤–å–ã€‚æ¿€å¢ = å†…éƒ¨äººå‘˜ç¦è¶³/åŠ ç­ã€‚</div>
                    </div>
                </div>

                <div class="tag-row">
                    <div class="tag-badge bg-yellow">CROWD</div>
                    <div class="tag-info">
                        <div class="tag-title">Wiseguy (Slices)</div>
                        <div class="tag-desc"><strong>äººå‘˜èšé›†</strong>ã€‚å•†åœˆæ•£å®¢ã€‚æ¿€å¢ = å…¬å…±/åª’ä½“äº‹ä»¶ã€‚</div>
                    </div>
                </div>

                <div class="tag-row">
                    <div class="tag-badge bg-green">FLANK</div>
                    <div class="tag-info">
                        <div class="tag-title">WeæŠ«è¨ (Crystal City)</div>
                        <div class="tag-desc"><strong>ä¾§ç¿¼è§‚å¯Ÿ</strong>ã€‚ä½äºæ°´æ™¶åŸã€‚ç”¨äºâ€œå»å™ªâ€å’Œå¯¹æ¯”éªŒè¯ã€‚</div>
                    </div>
                </div>
            </div>

            <div>
                <div class="man-section-title"><span>ğŸ§ </span> è”åˆæƒ…æŠ¥çŸ©é˜µ (INTEL MATRIX)</div>
                <div class="matrix-box">
                    
                    <div class="scenario-row">
                        <div class="s-condition">
                            <span class="c-red">SUPPLY é«˜</span> 
                            <span class="s-plus">+</span>
                            <span class="c-gray">CORE ä½</span>
                        </div>
                        <div class="s-result" style="color:var(--danger)">
                            ğŸš¨ å†…éƒ¨å°é”<br><span style="font-size:9px; color:#666; font-weight:normal">åªè¿›ä¸å‡º (ç‚¹å¤–å–)</span>
                        </div>
                    </div>
                    <div style="border-top:1px solid #222;"></div>

                    <div class="scenario-row">
                        <div class="s-condition">
                            <span class="c-red">CORE é«˜</span> 
                            <span class="s-plus">+</span>
                            <span class="c-gray">FLANK ä½</span>
                        </div>
                        <div class="s-result" style="color:var(--danger)">
                            ğŸ¯ ç¡®è®¤å¼‚å¸¸<br><span style="font-size:9px; color:#666; font-weight:normal">ä»…äº”è§’å¤§æ¥¼æ´»è·ƒ (éå…¨åŒº)</span>
                        </div>
                    </div>
                    <div style="border-top:1px solid #222;"></div>

                    <div class="scenario-row">
                        <div class="s-condition">
                            <span class="c-red">CORE é«˜</span> 
                            <span class="s-plus">+</span>
                            <span class="c-green">FLANK é«˜</span>
                        </div>
                        <div class="s-result" style="color:#fff">
                            ğŸ‰ è™šå‡è­¦æŠ¥<br><span style="font-size:9px; color:#666; font-weight:normal">å…¨åŒºéƒ½åœ¨è¿‡å‘¨æœ« (æ— æˆ˜æœ¯ä»·å€¼)</span>
                        </div>
                    </div>
                    <div style="border-top:1px solid #222;"></div>

                    <div class="scenario-row">
                        <div class="s-condition">
                            <span class="c-red">CORE é«˜</span> 
                            <span class="s-plus">+</span>
                            <span class="c-gray">CROWD é«˜</span>
                        </div>
                        <div class="s-result" style="color:var(--warn)">
                            ğŸ“¢ å…¬å…±äº‹ä»¶<br><span style="font-size:9px; color:#666; font-weight:normal">åª’ä½“/äººç¾¤èšé›†</span>
                        </div>
                    </div>

                </div>
            </div>
            
            <div style="font-size:10px; color:#444; text-align:center;">
                PENTAGON OPS V30 // PERFECTED
            </div>
        </div>
    </div>

    <script>
        const DICT = {
            "District": { 
                name: "ç‰¹åŒºæŠ«è¨", desc: "æ ¸å¿ƒæŒ‡æ ‡ (äº”è§’å¤§æ¥¼é¦–é€‰)", 
                role: "CORE INTEL", tagClass: "tag-red", isCore: true 
            },
            "Domino":   { 
                name: "è¾¾ç¾ä¹",   desc: "åå‹¤è¡¥ç»™ (ä¸»)", 
                role: "SUPPLY LINE", tagClass: "tag-blue", isCore: false 
            },
            "Papa":     { 
                name: "æ£’çº¦ç¿°",   desc: "åå‹¤è¡¥ç»™ (å¤‡)", 
                role: "SUPPLY LINE", tagClass: "tag-blue", isCore: false 
            },
            "Wiseguy":  { 
                name: "Wiseguy",  desc: "äººå‘˜èšé›† (æ•£å®¢)", 
                role: "CROWD INTEL", tagClass: "tag-yellow", isCore: false 
            },
            "We":       { 
                name: "WeæŠ«è¨",   desc: "ä¾§ç¿¼è§‚å¯Ÿ (æ°´æ™¶åŸ)", 
                role: "FLANK WATCH", tagClass: "tag-green", isCore: false 
            }
        };

        Papa.parse("pizza_data.csv", {
            download: true, header: true, skipEmptyLines: true,
            complete: function(res) {
                render(res.data);
            },
            error: function() {
                document.getElementById('list-area').innerHTML = '<div class="loading">æ•°æ®è¿æ¥å¤±è´¥</div>';
            }
        });

        function render(data) {
            if(!data || data.length === 0) return;

            const groups = {};
            data.forEach(row => {
                const rawName = row.Name || "";
                let key = null;
                if(rawName.includes("District")) key = "District";
                else if(rawName.includes("Domino")) key = "Domino";
                else if(rawName.includes("Papa")) key = "Papa";
                else if(rawName.includes("Wiseguy")) key = "Wiseguy";
                else if(rawName.includes("We")) key = "We";

                if(key) {
                    if(!groups[key]) groups[key] = [];
                    groups[key].push({
                        pop: parseInt(row['Live Popularity'] || 0),
                        time: row['Timestamp (ET)']
                    });
                }
            });

            let totalLivePop = 0; 
            let totalDiff = 0;    
            const shopDataList = [];
            
            Object.keys(groups).forEach(key => {
                const history = groups[key];
                if(history.length === 0) return;
                
                const current = history[history.length - 1];
                const currentPop = current.pop;

                let diff = 0;
                if(history.length >= 2) {
                    diff = currentPop - history[history.length - 2].pop;
                }

                totalLivePop += currentPop;
                totalDiff += diff;

                shopDataList.push({ key, history, currentPop, diff, current });
            });

            shopDataList.sort((a, b) => {
                if (DICT[a.key].isCore && !DICT[b.key].isCore) return -1;
                if (!DICT[a.key].isCore && DICT[b.key].isCore) return 1;
                return b.currentPop - a.currentPop;
            });

            const dashArea = document.getElementById('dash-area');
            let diffColor = "#888"; 
            let diffArrow = "-";
            if(totalDiff > 0) { diffColor = "var(--danger)"; diffArrow = "â–² +"; }
            else if(totalDiff < 0) { diffColor = "var(--safe)"; diffArrow = "â–¼ "; }
            let totalColor = totalLivePop > 150 ? "var(--danger)" : "#fff";

            dashArea.innerHTML = `
                <div class="dashboard-grid">
                    <div class="dash-card">
                        <div class="dash-glow"></div>
                        <div class="dash-lbl">å…¨ç½‘å®æ—¶æ€»çƒ­åº¦</div>
                        <div class="dash-val" style="color:${totalColor}">${totalLivePop}</div>
                        <div class="dash-sub" style="color:#666">5ä¸ªæ®ç‚¹æ±‡æ€»</div>
                    </div>
                    <div class="dash-card">
                        <div class="dash-glow"></div>
                        <div class="dash-lbl">1H æ€»å˜åŒ–é‡</div>
                        <div class="dash-val" style="color:${diffColor}">${diffArrow}${Math.abs(totalDiff)}</div>
                        <div class="dash-sub" style="color:${diffColor}">è¾ƒ1å°æ—¶å‰</div>
                    </div>
                </div>
            `;

            const listArea = document.getElementById('list-area');
            listArea.innerHTML = ""; 

            shopDataList.forEach(item => {
                const { key, history, currentPop, diff, current } = item;
                const conf = DICT[key];

                let diffHtml = `<span class="c-gray">--</span>`;
                if(diff > 0) diffHtml = `<span class="c-red">â–² +${diff}</span>`;
                else if(diff < 0) diffHtml = `<span class="c-green">â–¼ ${diff}</span>`;

                const last24 = history.slice(-24);
                const maxPop = Math.max(...last24.map(i => i.pop));

                const sparkData = history.slice(-20); 
                let barsHtml = "";
                sparkData.forEach((d, idx) => {
                    const isLast = idx === sparkData.length - 1;
                    const h = Math.max(5, d.pop);
                    const color = isLast ? '#fff' : (d.pop > 50 ? '#ff3b30' : '#333');
                    const opacity = isLast ? 1 : 0.6;
                    barsHtml += `<div class="spark-bar" style="height:${h}%; background:${color}; opacity:${opacity}"></div>`;
                });

                const coreClass = conf.isCore ? 'core-target' : '';
                const tagHtml = `<div class="tac-tag ${conf.tagClass}">${conf.role}</div>`;

                listArea.innerHTML += `
                <div class="card ${coreClass}">
                    ${tagHtml}
                    <div class="row-top">
                        <div>
                            <div class="shop-name">${conf.name}</div>
                            <div class="shop-desc">${conf.desc}</div>
                        </div>
                        <div class="big-score" style="color: ${currentPop > 50 ? '#ff3b30' : '#fff'}">${currentPop}</div>
                    </div>
                    <div class="row-stats">
                        <div class="stat-box">
                            <div class="stat-lbl">1H å˜åŒ–</div>
                            <div class="stat-val">${diffHtml}</div>
                        </div>
                        <div class="stat-box" style="border-left:1px solid #222; padding-left:10px;">
                            <div class="stat-lbl">24H å³°å€¼</div>
                            <div class="stat-val" style="color:#fff">${maxPop}</div>
                        </div>
                        <div class="stat-box" style="border-left:1px solid #222; padding-left:10px;">
                            <div class="stat-lbl">æ›´æ–°äº</div>
                            <div class="stat-val" style="color:#888">${current.time.split(" ")[1].substring(0,5)}</div>
                        </div>
                    </div>
                    <div class="spark-container">${barsHtml}</div>
                </div>
                `;
            });
        }
    </script>
</body>
</html>
