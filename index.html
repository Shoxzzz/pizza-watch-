<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>äº”è§’å¤§æ¥¼æƒ…æŠ¥å±€</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;700;900&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <style>
        :root { 
            --bg: #000000; 
            --card-bg: #141414; 
            --text: #ffffff; 
            --sub-text: #888888;
            --danger: #ff3b30;
            --warn: #ffcc00;
            --safe: #34c759;
            --blue: #007aff;
        }

        /* ğŸ”¥ å…³é”®ä¿®å¤ï¼šå…è®¸é¡µé¢æ»šåŠ¨ (overflow-y: auto) */
        html, body {
            background-color: var(--bg);
            color: var(--text);
            font-family: 'Noto Sans SC', sans-serif;
            margin: 0; padding: 0;
            width: 100%;
            /* âš ï¸ ä¹‹å‰è¿™é‡Œæ˜¯ hiddenï¼Œå¯¼è‡´æ»‘ä¸åŠ¨ã€‚ç°åœ¨æ”¹ä¸º autoï¼ */
            overflow-y: auto; 
            -webkit-overflow-scrolling: touch; /* iOS ä¸æ»‘æ»šåŠ¨ */
        }

        /* é¡¶éƒ¨å¯¼èˆª (å¸é™„æ•ˆæœ) */
        .header {
            padding: 16px 20px;
            background: rgba(20, 20, 20, 0.95);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-bottom: 1px solid #222;
            /* ç²˜æ€§å®šä½ï¼šåˆ’ä¸Šå»æ—¶å¸é¡¶ */
            position: sticky; 
            top: 0; 
            z-index: 999;
            display: flex; justify-content: space-between; align-items: center;
        }
        .title { font-size: 18px; font-weight: 900; letter-spacing: 1px; }
        .status-badge {
            font-size: 12px; font-weight: bold; color: var(--safe);
            background: rgba(52, 199, 89, 0.15);
            padding: 4px 10px; border-radius: 100px;
            display: flex; align-items: center; gap: 6px;
        }
        .blink { width: 6px; height: 6px; background: currentColor; border-radius: 50%; animation: blink 1.5s infinite; }
        @keyframes blink { 0% {opacity:1} 50% {opacity:0.3} 100% {opacity:1} }

        /* åˆ—è¡¨å®¹å™¨ */
        .container { 
            padding: 20px; 
            display: flex; 
            flex-direction: column; 
            gap: 16px; 
            /* åº•éƒ¨ç•™ç™½ï¼Œé˜²æ­¢è¢«æ‰‹æœºæ¨ªæ¡é®æŒ¡ */
            padding-bottom: 80px; 
        }

        /* æˆ˜æœ¯å¡ç‰‡ */
        .card {
            background: var(--card-bg);
            border: 1px solid #333;
            border-radius: 16px;
            padding: 20px;
            display: flex; flex-direction: column; gap: 12px;
            position: relative;
        }

        .card-header { display: flex; justify-content: space-between; align-items: flex-start; }
        .shop-name { font-size: 18px; font-weight: 700; margin-bottom: 4px; color: #fff; }
        .shop-desc { font-size: 12px; color: var(--sub-text); }
        
        .pop-score { font-size: 32px; font-weight: 900; line-height: 1; }
        .pop-label { font-size: 10px; color: var(--sub-text); text-align: right; margin-top: 4px; }

        .progress-bg { width: 100%; height: 6px; background: #333; border-radius: 3px; overflow: hidden; }
        .progress-bar { height: 100%; border-radius: 3px; transition: width 0.5s ease; }

        .card-footer { display: flex; justify-content: space-between; align-items: center; font-size: 12px; color: var(--sub-text); padding-top: 4px; }

        /* é¢œè‰²ç±» */
        .bg-red { background-color: var(--danger); }
        .bg-blue { background-color: var(--blue); }
        .bg-green { background-color: var(--safe); }
        .bg-yellow { background-color: var(--warn); }
        
        .text-red { color: var(--danger); }
        .text-white { color: #fff; }

        .loading { text-align: center; margin-top: 50px; color: #666; font-size: 14px; }
    </style>
</head>
<body>

    <div class="header">
        <div class="title">äº”è§’å¤§æ¥¼æƒ…æŠ¥å±€</div>
        <div class="status-badge"><div class="blink"></div>å®æ—¶ç›‘æ§</div>
    </div>

    <div class="container" id="list-area">
        <div class="loading">æ­£åœ¨è¿æ¥å«æ˜Ÿæ•°æ®...<br>è§£æä¸­æ–‡æ•°æ®åŒ…...</div>
    </div>

    <script>
        const DICT = {
            "District": { name: "ç‰¹åŒºæŠ«è¨", desc: "æ ¸å¿ƒæ®ç‚¹ (äº”è§’å¤§æ¥¼é¦–é€‰)", color: "bg-red" },
            "Domino":   { name: "è¾¾ç¾ä¹",   desc: "å¤–å–å·¨å¤´ (å¸¸è§„)",        color: "bg-blue" },
            "Papa":     { name: "æ£’çº¦ç¿°",   desc: "å¤–å–å·¨å¤´ (å¤‡é€‰)",        color: "bg-blue" },
            "Wiseguy":  { name: "Wiseguy",  desc: "åˆ‡ç‰‡æŠ«è¨åº— (æ•£å®¢)",      color: "bg-yellow" },
            "We":       { name: "WeæŠ«è¨",   desc: "æ°´æ™¶åŸåˆ†éƒ¨",            color: "bg-green" }
        };

        Papa.parse("pizza_data.csv", {
            download: true, header: true, skipEmptyLines: true,
            complete: function(res) {
                renderList(res.data);
            },
            error: function() {
                document.getElementById('list-area').innerHTML = '<div class="loading">è¯»å–å¤±è´¥</div>';
            }
        });

        function renderList(data) {
            if(!data || data.length === 0) return;

            const latest = {};
            // å€’åºæ‰¾æœ€æ–°æ•°æ®
            for(let i = data.length - 1; i >= 0; i--) {
                const row = data[i];
                const rawName = row.Name || "";
                
                let key = null;
                if(rawName.includes("District")) key = "District";
                else if(rawName.includes("Domino")) key = "Domino";
                else if(rawName.includes("Papa")) key = "Papa";
                else if(rawName.includes("Wiseguy")) key = "Wiseguy";
                else if(rawName.includes("We")) key = "We";

                if(key && !latest[key]) {
                    latest[key] = {
                        pop: parseInt(row['Live Popularity'] || 0),
                        gap: parseInt(row['Gap'] || 0),
                        time: row['Timestamp (ET)']
                    };
                }
                if(Object.keys(latest).length === 5) break;
            }

            // æŒ‰çƒ­åº¦æ’åº
            const list = Object.keys(latest).map(k => ({ key: k, ...latest[k] }))
                                          .sort((a, b) => b.pop - a.pop);

            const area = document.getElementById('list-area');
            area.innerHTML = ""; 

            list.forEach(item => {
                const conf = DICT[item.key];
                const pop = item.pop;
                const gap = item.gap;
                
                let timeStr = item.time;
                if(timeStr.includes(" ")) timeStr = timeStr.split(" ")[1].substring(0, 5);

                let statusHtml = `<span style="color:#666">å¹³ç¨³ (æ­£å¸¸)</span>`;
                if (gap >= 20) statusHtml = `<span style="color:var(--danger)">ğŸ”¥ æ¿€å¢ (+${gap})</span>`;
                else if (gap > 5) statusHtml = `<span style="color:var(--warn)">ğŸ“ˆ ä¸Šå‡ (+${gap})</span>`;
                else if (gap < -5) statusHtml = `<span style="color:var(--safe)">ğŸ“‰ ä¸‹é™ (${gap})</span>`;

                const scoreColor = pop > 50 ? 'text-red' : 'text-white';

                const html = `
                <div class="card">
                    <div class="card-header">
                        <div>
                            <div class="shop-name">${conf.name}</div>
                            <div class="shop-desc">${conf.desc}</div>
                        </div>
                        <div>
                            <div class="pop-score ${scoreColor}">${pop}</div>
                            <div class="pop-label">å½“å‰çƒ­åº¦</div>
                        </div>
                    </div>
                    <div class="progress-bg">
                        <div class="progress-bar ${conf.color}" style="width: ${pop}%"></div>
                    </div>
                    <div class="card-footer">
                        <div>${statusHtml}</div>
                        <div>æ›´æ–°äº ${timeStr}</div>
                    </div>
                </div>
                `;
                area.innerHTML += html;
            });
            
            area.innerHTML += `<div style="text-align:center; font-size:10px; color:#333; margin-top:10px;">PENTAGON OPS V18 // SCROLL UNLOCKED</div>`;
        }
    </script>
</body>
</html>
