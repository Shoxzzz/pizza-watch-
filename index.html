<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>äº”è§’å¤§æ¥¼æƒ…æŠ¥å±€</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;700;900&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <style>
        :root { 
            --bg: #000000; 
            --card-bg: #121212; 
            --dash-bg: #1a1a1a;
            --text: #ffffff; 
            --sub-text: #666;
            --danger: #ff3b30;
            --warn: #ffcc00;
            --safe: #32d74b;
            --blue: #0a84ff;
        }

        html, body {
            background-color: var(--bg);
            color: var(--text);
            font-family: 'Noto Sans SC', sans-serif;
            margin: 0; padding: 0;
            width: 100%;
            overflow-y: auto; 
            -webkit-overflow-scrolling: touch;
        }

        .header {
            padding: 16px 20px;
            background: rgba(10, 10, 10, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid #222;
            position: sticky; top: 0; z-index: 999;
            display: flex; justify-content: space-between; align-items: center;
        }
        .title { font-size: 16px; font-weight: 900; letter-spacing: 1px; color: #fff; }
        .live-badge {
            font-size: 11px; font-weight: bold; color: var(--safe);
            background: rgba(50, 215, 75, 0.1);
            padding: 4px 8px; border-radius: 4px;
            display: flex; align-items: center; gap: 6px;
        }
        .blink { width: 6px; height: 6px; background: currentColor; border-radius: 50%; animation: blink 2s infinite; }
        @keyframes blink { 0% {opacity:1} 50% {opacity:0.3} 100% {opacity:1} }

        .container { padding: 15px; display: flex; flex-direction: column; gap: 15px; padding-bottom: 80px; }

        /* ä»ªè¡¨ç›˜ */
        .dashboard-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 5px; }
        .dash-card {
            background: var(--dash-bg); border: 1px solid #333; border-radius: 12px;
            padding: 15px; display: flex; flex-direction: column; justify-content: center;
            position: relative; overflow: hidden;
        }
        .dash-glow {
            position: absolute; top: -50%; right: -50%; width: 100%; height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.05) 0%, transparent 60%); pointer-events: none;
        }
        .dash-lbl { font-size: 11px; color: #888; text-transform: uppercase; font-weight: bold; margin-bottom: 4px; }
        .dash-val { font-size: 26px; font-weight: 900; line-height: 1; }
        .dash-sub { font-size: 11px; margin-top: 4px; font-weight: 500; }

        /* å¡ç‰‡ */
        .card { 
            background: var(--card-bg); border: 1px solid #2a2a2a; border-radius: 12px; 
            padding: 16px; display: flex; flex-direction: column; gap: 12px; position: relative; overflow: hidden;
        }
        .tac-tag {
            position: absolute; top: 0; right: 0;
            font-size: 9px; font-weight: 900; letter-spacing: 0.5px;
            padding: 3px 10px;
            border-bottom-left-radius: 10px;
            text-transform: uppercase;
        }
        .tag-red { background: rgba(255, 59, 48, 0.2); color: var(--danger); border-left: 1px solid var(--danger); border-bottom: 1px solid var(--danger); }
        .tag-blue { background: rgba(10, 132, 255, 0.2); color: var(--blue); border-left: 1px solid var(--blue); border-bottom: 1px solid var(--blue); }
        .tag-yellow { background: rgba(255, 204, 0, 0.2); color: var(--warn); border-left: 1px solid var(--warn); border-bottom: 1px solid var(--warn); }
        .tag-green { background: rgba(50, 215, 75, 0.2); color: var(--safe); border-left: 1px solid var(--safe); border-bottom: 1px solid var(--safe); }

        .card.core-target {
            border: 1px solid rgba(255, 59, 48, 0.4);
            box-shadow: 0 0 20px rgba(255, 59, 48, 0.05) inset;
        }

        .row-top { display: flex; justify-content: space-between; align-items: flex-start; margin-top: 4px; }
        .shop-name { font-size: 16px; font-weight: 700; color: #fff; margin-bottom: 2px; }
        .shop-desc { font-size: 11px; color: var(--sub-text); }
        .big-score { font-size: 28px; font-weight: 900; line-height: 1; letter-spacing: -1px; }

        .row-stats { display: flex; gap: 10px; padding: 10px; background: #080808; border-radius: 8px; border: 1px solid #222; }
        .stat-box { flex: 1; display: flex; flex-direction: column; gap: 2px; }
        .stat-lbl { font-size: 10px; color: #555; }
        .stat-val { font-size: 13px; font-weight: 700; }

        .spark-container { display: flex; align-items: flex-end; gap: 2px; height: 30px; margin-top: 5px; padding-top: 10px; border-top: 1px dashed #222; }
        .spark-bar { flex: 1; background: #333; border-radius: 2px; min-height: 2px; }

        /* æ‰‹å†Œæ ·å¼ */
        .manual-card { background: #090909; border: 1px solid #333; border-radius: 12px; padding: 20px; display: flex; flex-direction: column; gap: 15px; }
        .man-header { font-size: 13px; font-weight: 900; color: #fff; text-transform: uppercase; letter-spacing: 1px; border-bottom: 1px solid #333; padding-bottom: 10px; margin-bottom: 5px; display: flex; align-items: center; gap: 8px; }
        
        .man-list { display: flex; flex-direction: column; gap: 15px; }
        .man-item { display: flex; gap: 12px; }
        
        /* æ ‡ç­¾å›¾ä¾‹ */
        .man-tag-icon { 
            width: 32px; height: 16px; border-radius: 4px; flex-shrink: 0; margin-top: 2px;
            font-size: 8px; font-weight: 900; display: flex; align-items: center; justify-content: center;
        }
        .bg-red { background: var(--danger); color: #000; }
        .bg-blue { background: var(--blue); color: #000; }
        .bg-yellow { background: var(--warn); color: #000; }
        .bg-green { background: var(--safe); color: #000; }

        .man-content { display: flex; flex-direction: column; gap: 4px; }
        .man-title { font-size: 12px; font-weight: bold; color: #fff; }
        .man-desc { font-size: 11px; color: #888; line-height: 1.4; }

        .c-red { color: var(--danger); }
        .loading { text-align: center; margin-top: 50px; color: #444; font-size: 12px; }
    </style>
</head>
<body>

    <div class="header">
        <div class="title">äº”è§’å¤§æ¥¼æƒ…æŠ¥å±€</div>
        <div class="live-badge"><div class="blink"></div>LIVE</div>
    </div>

    <div class="container">
        <div id="dash-area"></div>
        <div id="list-area">
            <div class="loading">æ­£åœ¨è§£å¯†å«æ˜Ÿæ•°æ®æµ...</div>
        </div>

        <div class="manual-card">
            <div class="man-header">
                <span>ğŸ›¡ï¸</span> æˆ˜æœ¯æ ‡è¯†è¯¦è§£ (TACTICAL GUIDE)
            </div>

            <div class="man-list">
                
                <div class="man-item">
                    <div class="man-tag-icon bg-red">CORE</div>
                    <div class="man-content">
                        <div class="man-title">æ ¸å¿ƒå“¨æ‰€ (District Pizza)</div>
                        <div class="man-desc">
                            <strong>å®šä¹‰ï¼š</strong> è·ç¦»äº”è§’å¤§æ¥¼æœ€è¿‘çš„æ·±å¤œè¥ä¸šç‚¹ã€‚<br>
                            <strong>æˆ˜æœ¯é€»è¾‘ï¼š</strong> å› è·ç¦»å¤ªè¿‘ï¼Œå®ƒå¯¹å¤§æ¥¼å†…éƒ¨çš„äººå‘˜æµåŠ¨æœ€æ•æ„Ÿã€‚å¦‚æœå…¶ä»–åº—éƒ½æ²¡äººï¼Œåªæœ‰è¿™é‡Œçˆ†æ»¡ï¼Œè¯´æ˜æ˜¯<strong>å†…éƒ¨å°èŒƒå›´ç´§æ€¥äº‹æ€</strong>ã€‚
                        </div>
                    </div>
                </div>

                <div class="man-item">
                    <div class="man-tag-icon bg-blue">SUPPLY</div>
                    <div class="man-content">
                        <div class="man-title">è¡¥ç»™çº¿ (Domino's / Papa John's)</div>
                        <div class="man-desc">
                            <strong>å®šä¹‰ï¼š</strong> ä¸»è¥å¤–å–é…é€çš„è¿é”å·¨å¤´ã€‚<br>
                            <strong>æˆ˜æœ¯é€»è¾‘ï¼š</strong> å½“å®˜å‘˜ä»¬è¢«é™åˆ¶ç¦»å¼€å¤§æ¥¼ï¼ˆå¦‚é‡å¤§å±æœºæŒ‡æŒ¥ä¸­ï¼‰æ—¶ï¼Œå¿…é¡»ä¾èµ–æ‰¹é‡å¤–å–ã€‚æ­¤å¤„æ¿€å¢ä»£è¡¨<strong>â€œå…¨å‘˜åŠ ç­/ç¦è¶³â€</strong>ã€‚
                        </div>
                    </div>
                </div>

                <div class="man-item">
                    <div class="man-tag-icon bg-yellow">CROWD</div>
                    <div class="man-content">
                        <div class="man-title">äººå‘˜èšé›† (Wiseguy)</div>
                        <div class="man-desc">
                            <strong>å®šä¹‰ï¼š</strong> ä½äºå•†åœˆçš„åˆ‡ç‰‡æŠ«è¨åº—ï¼Œä¸»æ‰“æ•£å®¢ã€‚<br>
                            <strong>æˆ˜æœ¯é€»è¾‘ï¼š</strong> å®ƒçš„çƒ­åº¦ä»£è¡¨<strong>â€œç‰©ç†äººç¾¤å¯†åº¦â€</strong>ã€‚å¦‚æœæ­¤å¤„çˆ†æ»¡ï¼Œå¯èƒ½æ˜¯æœ‰åª’ä½“èšé›†ã€ä¼‘ç­äººå‘˜èšé¤æˆ–å‘¨è¾¹æœ‰å…¬å…±æ´»åŠ¨ã€‚
                        </div>
                    </div>
                </div>

                <div class="man-item">
                    <div class="man-tag-icon bg-green">FLANK</div>
                    <div class="man-content">
                        <div class="man-title">ä¾§ç¿¼è§‚å¯Ÿ (We Pizza)</div>
                        <div class="man-desc">
                            <strong>å®šä¹‰ï¼š</strong> ä½äºæ°´æ™¶åŸï¼ˆCrystal Cityï¼‰çš„åˆ†éƒ¨ã€‚<br>
                            <strong>æˆ˜æœ¯é€»è¾‘ï¼š</strong> å®ƒæ˜¯<strong>å¯¹ç…§ç»„</strong>ã€‚å¦‚æœ We æŠ«è¨å’Œç‰¹åŒºæŠ«è¨åŒæ—¶çˆ†æ»¡ï¼Œè¯´æ˜åªæ˜¯â€œå‘¨æœ«å¤§å®¶éƒ½åœ¨åƒæŠ«è¨â€ã€‚å¦‚æœ We æŠ«è¨å¾ˆå†·æ¸…ï¼Œè€Œæ ¸å¿ƒå“¨æ‰€çˆ†æ»¡ï¼Œæ‰æ˜¯çœŸæ­£çš„æƒ…æŠ¥ã€‚
                        </div>
                    </div>
                </div>

            </div>
            
            <div style="font-size:10px; color:#444; margin-top:10px; border-top:1px dashed #333; padding-top:10px; text-align:center;">
                PENTAGON OPS V26 // FIELD MANUAL
            </div>
        </div>
    </div>

    <script>
        const DICT = {
            "District": { 
                name: "ç‰¹åŒºæŠ«è¨", desc: "æ ¸å¿ƒæŒ‡æ ‡ (äº”è§’å¤§æ¥¼é¦–é€‰)", 
                role: "CORE INTEL", tagClass: "tag-red", isCore: true 
            },
            "Domino":   { 
                name: "è¾¾ç¾ä¹",   desc: "åå‹¤è¡¥ç»™ (ä¸»)", 
                role: "SUPPLY LINE", tagClass: "tag-blue", isCore: false 
            },
            "Papa":     { 
                name: "æ£’çº¦ç¿°",   desc: "åå‹¤è¡¥ç»™ (å¤‡)", 
                role: "SUPPLY LINE", tagClass: "tag-blue", isCore: false 
            },
            "Wiseguy":  { 
                name: "Wiseguy",  desc: "äººå‘˜èšé›† (æ•£å®¢)", 
                role: "CROWD INTEL", tagClass: "tag-yellow", isCore: false 
            },
            "We":       { 
                name: "WeæŠ«è¨",   desc: "ä¾§ç¿¼è§‚å¯Ÿ (æ°´æ™¶åŸ)", 
                role: "FLANK WATCH", tagClass: "tag-green", isCore: false 
            }
        };

        Papa.parse("pizza_data.csv", {
            download: true, header: true, skipEmptyLines: true,
            complete: function(res) {
                render(res.data);
            },
            error: function() {
                document.getElementById('list-area').innerHTML = '<div class="loading">æ•°æ®è¿æ¥å¤±è´¥</div>';
            }
        });

        function render(data) {
            if(!data || data.length === 0) return;

            const groups = {};
            data.forEach(row => {
                const rawName = row.Name || "";
                let key = null;
                if(rawName.includes("District")) key = "District";
                else if(rawName.includes("Domino")) key = "Domino";
                else if(rawName.includes("Papa")) key = "Papa";
                else if(rawName.includes("Wiseguy")) key = "Wiseguy";
                else if(rawName.includes("We")) key = "We";

                if(key) {
                    if(!groups[key]) groups[key] = [];
                    groups[key].push({
                        pop: parseInt(row['Live Popularity'] || 0),
                        time: row['Timestamp (ET)']
                    });
                }
            });

            let totalLivePop = 0; 
            let totalDiff = 0;    
            const shopDataList = [];
            
            Object.keys(groups).forEach(key => {
                const history = groups[key];
                if(history.length === 0) return;
                
                const current = history[history.length - 1];
                const currentPop = current.pop;

                let diff = 0;
                if(history.length >= 2) {
                    diff = currentPop - history[history.length - 2].pop;
                }

                totalLivePop += currentPop;
                totalDiff += diff;

                shopDataList.push({ key, history, currentPop, diff, current });
            });

            shopDataList.sort((a, b) => {
                if (DICT[a.key].isCore && !DICT[b.key].isCore) return -1;
                if (!DICT[a.key].isCore && DICT[b.key].isCore) return 1;
                return b.currentPop - a.currentPop;
            });

            const dashArea = document.getElementById('dash-area');
            let diffColor = "#888"; 
            let diffArrow = "-";
            if(totalDiff > 0) { diffColor = "var(--danger)"; diffArrow = "â–² +"; }
            else if(totalDiff < 0) { diffColor = "var(--safe)"; diffArrow = "â–¼ "; }
            let totalColor = totalLivePop > 150 ? "var(--danger)" : "#fff";

            dashArea.innerHTML = `
                <div class="dashboard-grid">
                    <div class="dash-card">
                        <div class="dash-glow"></div>
                        <div class="dash-lbl">å…¨ç½‘å®æ—¶æ€»çƒ­åº¦</div>
                        <div class="dash-val" style="color:${totalColor}">${totalLivePop}</div>
                        <div class="dash-sub" style="color:#666">5ä¸ªæ®ç‚¹æ±‡æ€»</div>
                    </div>
                    <div class="dash-card">
                        <div class="dash-glow"></div>
                        <div class="dash-lbl">1H æ€»å˜åŒ–é‡</div>
                        <div class="dash-val" style="color:${diffColor}">${diffArrow}${Math.abs(totalDiff)}</div>
                        <div class="dash-sub" style="color:${diffColor}">è¾ƒ1å°æ—¶å‰</div>
                    </div>
                </div>
            `;

            const listArea = document.getElementById('list-area');
            listArea.innerHTML = ""; 

            shopDataList.forEach(item => {
                const { key, history, currentPop, diff, current } = item;
                const conf = DICT[key];

                let diffHtml = `<span class="c-gray">--</span>`;
                if(diff > 0) diffHtml = `<span class="c-red">â–² +${diff}</span>`;
                else if(diff < 0) diffHtml = `<span class="c-green">â–¼ ${diff}</span>`;

                const last24 = history.slice(-24);
                const maxPop = Math.max(...last24.map(i => i.pop));

                const sparkData = history.slice(-20); 
                let barsHtml = "";
                sparkData.forEach((d, idx) => {
                    const isLast = idx === sparkData.length - 1;
                    const h = Math.max(5, d.pop);
                    const color = isLast ? '#fff' : (d.pop > 50 ? '#ff3b30' : '#333');
                    const opacity = isLast ? 1 : 0.6;
                    barsHtml += `<div class="spark-bar" style="height:${h}%; background:${color}; opacity:${opacity}"></div>`;
                });

                const coreClass = conf.isCore ? 'core-target' : '';
                const tagHtml = `<div class="tac-tag ${conf.tagClass}">${conf.role}</div>`;

                listArea.innerHTML += `
                <div class="card ${coreClass}">
                    ${tagHtml}
                    <div class="row-top">
                        <div>
                            <div class="shop-name">${conf.name}</div>
                            <div class="shop-desc">${conf.desc}</div>
                        </div>
                        <div class="big-score" style="color: ${currentPop > 50 ? '#ff3b30' : '#fff'}">${currentPop}</div>
                    </div>
                    <div class="row-stats">
                        <div class="stat-box">
                            <div class="stat-lbl">1H å˜åŒ–</div>
                            <div class="stat-val">${diffHtml}</div>
                        </div>
                        <div class="stat-box" style="border-left:1px solid #222; padding-left:10px;">
                            <div class="stat-lbl">24H å³°å€¼</div>
                            <div class="stat-val" style="color:#fff">${maxPop}</div>
                        </div>
                        <div class="stat-box" style="border-left:1px solid #222; padding-left:10px;">
                            <div class="stat-lbl">æ›´æ–°äº</div>
                            <div class="stat-val" style="color:#888">${current.time.split(" ")[1].substring(0,5)}</div>
                        </div>
                    </div>
                    <div class="spark-container">${barsHtml}</div>
                </div>
                `;
            });
        }
    </script>
</body>
</html>
