name: Pentagon Pizza Watch V5 (Hourly)

# è§¦å‘æœºåˆ¶
on:
  schedule:
    # ğŸ•’ æ”¹ä¸ºï¼šæ¯å°æ—¶çš„ç¬¬ 0 åˆ†é’Ÿè¿è¡Œ (æ•´ç‚¹ä¾¦å¯Ÿ)
    # å¯¹åº”åŒ—äº¬æ—¶é—´å¯èƒ½æ˜¯ 8:00, 9:00, 10:00... (ä¼šæœ‰åå‡ åˆ†é’Ÿå»¶è¿Ÿ)
    - cron: '0 * * * *'
  # æ‰‹åŠ¨æ ¸æŒ‰é’® (ä¿ç•™)
  workflow_dispatch:

# ğŸ›¡ï¸ æˆ˜æœ¯å¹¶å‘æ§åˆ¶
concurrency:
  group: pentagon-intel-v5
  cancel-in-progress: true

# ğŸ”’ å†™æƒé™ (å¿…é¡»æœ‰)
permissions:
  contents: write

jobs:
  black-ops:
    runs-on: ubuntu-latest
    timeout-minutes: 20

    steps:
    - name: ğŸ“¥ æ‹‰å–æœ€æ–°æƒ…æŠ¥ (Checkout)
      uses: actions/checkout@v4

    - name: ğŸ éƒ¨ç½² Python 3.10 ç¯å¢ƒ
      uses: actions/setup-python@v5
      with:
        python-version: '3.10'
        cache: 'pip' # âš¡ï¸ å¼€å¯ç¼“å­˜åŠ é€Ÿ

    - name: ğŸ› ï¸ è£…å¡«æˆ˜æœ¯è£…å¤‡ (Install Deps)
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt

    - name: ğŸ•µï¸â€â™‚ï¸ æ‰§è¡Œ V5 ä¾¦å¯Ÿä»»åŠ¡ (Execute)
      env:
        DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
      # -u å®æ—¶æ—¥å¿—
      run: python -u monitor.py

    - name: ğŸ’¾ åŒæ­¥æƒ…æŠ¥æ•°æ®åº“ (Sync Data)
      run: |
        git config --global user.name "Pentagon V5 Bot"
        git config --global user.email "intel@pentagon.watch"
        
        # âš ï¸ å¿…é¡»åŒæ—¶è¿½è¸ªæ•°æ®å’Œå½’æ¡£
        git add pizza_data.csv pizza_archive.csv || true
        
        timestamp=$(date -u)
        git commit -m "HOURLY INTEL UPDATE: $timestamp" || echo "âš ï¸ æœ¬æ¬¡æ— æ–°æƒ…æŠ¥"
        
        git push
