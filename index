<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>äº”è§’å¤§æ¥¼æŠ«è¨æƒ…æŠ¥ä¸­å¿ƒ</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <style>
        /* ğŸŒ‘ å…¨å±€èƒŒæ™¯ï¼šæ·±é‚ƒçš„åˆå¤œè“ */
        body {
            background-color: #0f172a; 
            background-image: radial-gradient(circle at 50% 50%, #1e293b 0%, #0f172a 100%);
            color: #e2e8f0;
            font-family: 'Segoe UI', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }

        h1 {
            text-transform: uppercase;
            letter-spacing: 2px;
            text-shadow: 0 0 10px rgba(56, 189, 248, 0.5);
            margin-bottom: 30px;
        }

        /* ğŸ”® ç»ç’ƒæ‹Ÿæ€å¡ç‰‡æ ¸å¿ƒä»£ç  */
        .glass-panel {
            background: rgba(30, 41, 59, 0.7); /* åŠé€æ˜æ·±è‰² */
            backdrop-filter: blur(12px);       /* æ¯›ç»ç’ƒæ¨¡ç³Šæ•ˆæœ */
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1); /* å¾®å¼±çš„ç™½è¾¹æ¡† */
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
            border-radius: 16px;
            padding: 20px;
            width: 90%;
            max-width: 1000px;
            margin-bottom: 20px;
        }

        .chart-container {
            position: relative;
            height: 50vh; /* å›¾è¡¨é«˜åº¦ */
            width: 100%;
        }

        .status-bar {
            display: flex;
            justify-content: space-between;
            font-size: 0.9em;
            color: #94a3b8;
            margin-top: 10px;
        }

        .live-indicator {
            color: #4ade80; /* ç»¿è‰²å‘¼å¸ç¯ */
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .live-dot {
            width: 8px;
            height: 8px;
            background-color: #4ade80;
            border-radius: 50%;
            box-shadow: 0 0 8px #4ade80;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
    </style>
</head>
<body>

    <h1>ğŸ• Pentagon Pizza Index</h1>

    <div class="glass-panel">
        <div class="chart-container">
            <canvas id="pizzaChart"></canvas>
        </div>
        <div class="status-bar">
            <span>æ•°æ®æº: Google Maps Live Data</span>
            <div class="live-indicator"><div class="live-dot"></div>ç³»ç»Ÿè¿è¡Œä¸­</div>
        </div>
    </div>

    <script>
        // é…ç½®ï¼šæ¯å®¶åº—å¯¹åº”çš„çº¿æ¡é¢œè‰² (éœ“è™¹é…è‰²)
        const colors = {
            "District Pizza Palace": "#ff0055", // çº¢è‰²è­¦æˆ’ (æ ¸å¿ƒ)
            "Domino's Pizza": "#00f2ff",       // é’è‰² (å¤–å–)
            "Papa John's Pizza": "#cc00ff",    // ç´«è‰²
            "Wiseguy Pizza": "#ffe600",        // é»„è‰²
            "We": "#00ff9d"                    // ç»¿è‰²
        };

        // è¯»å– CSV æ•°æ®
        Papa.parse("pizza_data.csv", {
            download: true,
            header: true,
            complete: function(results) {
                processData(results.data);
            }
        });

        function processData(data) {
            // 1. æ•°æ®æ¸…æ´—ä¸åˆ†ç»„
            const shops = {};
            const timestamps = new Set();

            data.forEach(row => {
                if (!row.Name || !row.Timestamp) return;
                
                // æ”¶é›†æ‰€æœ‰æ—¶é—´ç‚¹ï¼ˆXè½´ï¼‰
                // æˆªå–æ—¶é—´å­—ç¬¦ä¸²ï¼Œåªè¦ HH:MM éƒ¨åˆ†ï¼Œçœ‹èµ·æ¥æ›´ç®€æ´
                const timeLabel = row['Timestamp (ET)'].substring(5, 16); 
                timestamps.add(timeLabel);

                // æŒ‰åº—åå½’ç±»æ•°æ®
                if (!shops[row.Name]) {
                    shops[row.Name] = [];
                }
                // å­˜å…¥: {x: æ—¶é—´, y: çƒ­åº¦}
                shops[row.Name].push({
                    x: timeLabel,
                    y: parseInt(row['Live Popularity']) || 0
                });
            });

            // æ’åºæ—¶é—´è½´
            const sortedLabels = Array.from(timestamps).sort();

            // 2. æ„å»º Chart.js æ•°æ®é›†
            const datasets = Object.keys(shops).map(shopName => {
                // åŒ¹é…æ•°æ®åˆ°æ­£ç¡®çš„æ—¶é—´ç‚¹ï¼ˆé˜²æ­¢æœ‰çš„åº—ç¼ºæ•°æ®å¯¼è‡´é”™ä½ï¼‰
                const dataPoints = sortedLabels.map(label => {
                    const found = shops[shopName].find(p => p.x === label);
                    return found ? found.y : null;
                });

                return {
                    label: shopName,
                    data: dataPoints,
                    borderColor: colors[shopName] || "#ffffff",
                    backgroundColor: (colors[shopName] || "#ffffff") + "20", // åŠ ä¸€ç‚¹é€æ˜åº¦åšèƒŒæ™¯
                    borderWidth: 2,
                    tension: 0.4, // æ›²çº¿å¹³æ»‘åº¦
                    pointRadius: 3,
                    pointHoverRadius: 6
                };
            });

            // 3. æ¸²æŸ“å›¾è¡¨
            const ctx = document.getElementById('pizzaChart').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: sortedLabels,
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        mode: 'index',
                        intersect: false,
                    },
                    plugins: {
                        legend: {
                            labels: { color: '#cbd5e1' }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(15, 23, 42, 0.9)',
                            titleColor: '#fff',
                            bodyColor: '#fff',
                            borderColor: 'rgba(255,255,255,0.1)',
                            borderWidth: 1
                        }
                    },
                    scales: {
                        x: {
                            ticks: { color: '#94a3b8' },
                            grid: { color: 'rgba(255,255,255,0.05)' }
                        },
                        y: {
                            beginAtZero: true,
                            max: 100, // çƒ­åº¦æœ€é«˜ 100
                            ticks: { color: '#94a3b8' },
                            grid: { color: 'rgba(255,255,255,0.05)' }
                        }
                    }
                }
            });
        }
    </script>
</body>
</html>
